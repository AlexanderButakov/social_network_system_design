# social_network_system_design
Designing a mega cool social network app


## Функциональные требования:
* Создание поста
  - Загрузка фотографий
  - Добавление текста описания, заголовка
  - Добавление геометки
  - Редактирование поста
* Просмотр постов других пользователей
  * добавление комментариев
  * оценка поста
* Подписка на пользователя
* Поиск мест
  * просмотр постов об этих местах
* Просмотр ленты пользователей
  * Сортировка в обратном хронолог. порядке
* Просмотр своей ленты
  * Сортировка в обратном хронолог. порядке


## Нефункциональные требования:
* 10 000 000 DAU
* Доступность 99,9
* Доступ через мобильное приложение и браузер
* Данные храним всегда
* Аудитория стран СНГ
* Активность пользователей:
  * Посты:
    * Создание поста - в среднем 1 раз в неделю (100 символов заголовок, 5000 символов описание, 10 фотографий (400кб макс. размер фото))
    * Чтение постов - в среднем 10 постов в день
  * Комментарии:
    * Просмотр - 10 раз по 20 комментариев / день
    * Добавление - 20 комментариев (3000 символов) / день (Половина DAU будет оставлять комментарии)
  * Оценки:
    * Добавление оценки - 10 оценок / день (половина DAU оценивает посты)
  * Подписка:
    * На двух пользователей в день
  * Поиск:
    * Два запроса в минуту
    * 50 постов в выдаче (Заголовок + часть описания)
  * Своя лента:
    * Просмотр ленты два раза в день
    * Неограниченное количество постов (пагинация по 20 шт., заголовок + часть описания + 1 фото)
  * Ленты других пользователей:
    * Просмотр 20 лент / день
    * Неограниченное количество постов (пагинация по 20 шт., заголовок + часть описания + 1 фото)
* Лимиты:
  * Сезонность - в летние месяцы больше активность
  * Тайминги:
    * Создание поста: 3 сек.
    * Чтение поста: 1 сек.
    * Добавление комментария: 1 сек.
    * Чтение комментариев: 2 сек.
    * Добавление оценки: 1 сек.
    * Поиск: 2 сек.
    * Просмотр ленты: 2 сек.

## Модель данных:
* Пост:
  * id:  8 bytes
  * user_id:  8 bytes
  * title:  100 bytes
  * contents:  5200 bytes (5.2Kb)
  * geocoordinates [...]:  72 bytes
  * photos [...]:  150 bytes
  * created_at:  8 bytes

* Комментарий:
  * id:  8 bytes
  * post_id:  8 bytes
  * user_id:  8 bytes
  * contents: 3000 bytes (3Kb)
  * created_at:  8 bytes

* Оценка:
  * post_id:  8 bytes
  * score:  32 bytes (это сумма. Приходит 8 байт в запросе)

* Подписка:
  * author_id
  * follower_ids [...]

## Расчет нагрузки:
* Посты:
  * RPS: 
    * RPS(w текст) = 10 000 000 * 1 / 7 / 86400 = 17
    * RPS(w фото) = 10 000 000 * 10 / 7 / 86400 = 165
    * RPS(r) = 10 000 000 * 10 / 86400 = 1157
  * Трафик:
    * Traffic(w текст) = 17 * 5550 = 94.35Kb
    * Traffic(w фото) = 165 * 400000 = 66Mb
    * Traffic(r) = 1157 * (66Mb + 94.35Kb) = 76.5Gb
* Комментарии:
  * RPS: 
    * RPS(r) = 10 000 000 * 200 / 86400 = 2314
    * RPS(w) = 10 000 000 / 2 * 20 / 86400 = 1157
  * Трафик:
    * Traffic(w) = 1157 * 3Kb = 3508024 (3.5Mb)
    * Traffic(r) = 2314 * 3Kb * 20 = 139Kb
* Оценки:
  * RPS: 
    * RPS(w) = 10 000 000 / 2 * 10 / 86400 = 579
    * RPS(r) = 10 000 000 * 10 / 86400 = 1157
  * Трафик:
    * Traffic(w) = 579 * 16b = 9264 (9.3Kb)
    * Traffic(r) = 1157 * 40b = 46280b (46.3Kb)
* Поиск:
  * RPS:
    * RPS(r) = 10 000 000 * 2 / 60 = 333333
  * Traffic:
    * Traffic(r) = 333333 * 50 * (100b + 1000) = 18Gb
* Просмотр своей ленты:
  * RPS:
    * RPS(r) = 10 000 000 * 2 / 86400 = 231
  * Traffic:
    * Traffic(r) = 231 * 20 * 400000b + 100b + 1000 = 1.9Gb
* Просмотр чужих лент:
  * RPS:
    * RPS(r) = 10 000 000 * 20 / 86400 = 2314
  * Traffic:
    * Traffic(r) = 2314 * 20 * 400000b + 100b + 1000 = 18.6Gb

### Количество соединений
* 10000000 * 0.1 = 1000000